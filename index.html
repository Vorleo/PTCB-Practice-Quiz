<!doctype html>
<html lang="en" data-theme="fallout" data-fx="on">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>PTCB Practice Test</title>
<style>
:root{
  --bg:#f6f7fb; --card:#ffffff; --text:#111; --muted:#556; --border:#ddd;
  --accent:#2563eb; --accent2:#1d4ed8; --chip:rgba(127,127,127,.10);
  --good:#22c55e; --warn:#f59e0b; --bad:#ef4444;
  --shadow:0 8px 24px rgba(0,0,0,.12);
  --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Courier New", monospace;
}
html[data-theme="amoled"]{--bg:#000;--card:#050505;--text:#e5e7eb;--muted:#9ca3af;--border:#222;--accent:#4f8cff;--accent2:#2f6fff;--chip:rgba(255,255,255,.08);--shadow:0 10px 26px rgba(0,0,0,.55);}
html[data-theme="navy"]{--bg:#0a1224;--card:#111b33;--text:#e5e7eb;--muted:#b7c0d6;--border:#25345a;--accent:#60a5fa;--accent2:#3b82f6;--chip:rgba(255,255,255,.08);--shadow:0 10px 26px rgba(0,0,0,.35);}
html[data-theme="terminal"]{--bg:#020403;--card:#06130b;--text:#7cffb2;--muted:#54c98a;--border:#0f2c1b;--accent:#00ff88;--accent2:#00d973;--chip:rgba(0,255,136,.10);--shadow:0 10px 26px rgba(0,0,0,.55);}
html[data-theme="purple"]{--bg:#120018;--card:#1e0030;--text:#f3d9ff;--muted:#d8b4fe;--border:#3c0066;--accent:#c084fc;--accent2:#a855f7;--chip:rgba(192,132,252,.12);--shadow:0 10px 26px rgba(0,0,0,.50);}
html[data-theme="lab"]{--bg:#f4fdff;--card:#ffffff;--text:#003c44;--muted:#2b6b74;--border:#c8eef5;--accent:#00a8a8;--accent2:#008888;--chip:rgba(0,168,168,.10);--shadow:0 10px 26px rgba(0,0,0,.12);}
html[data-theme="synthwave"]{--bg:#0a0016;--card:#16002b;--text:#ffd9ff;--muted:#f0abfc;--border:#4b0073;--accent:#ff00aa;--accent2:#d1008a;--chip:rgba(255,0,170,.10);--shadow:0 10px 26px rgba(0,0,0,.55);}
html[data-theme="paper"]{--bg:#fbf7ef;--card:#fffdf8;--text:#1b1b1b;--muted:#5a5a5a;--border:#e7ddcc;--accent:#8b5cf6;--accent2:#6d28d9;--chip:rgba(139,92,246,.08);--shadow:0 8px 20px rgba(0,0,0,.10);}
html[data-theme="fallout"]{--bg:#071208;--card:#0b1c0f;--text:#7cff9e;--muted:#58d679;--border:#1f4a2d;--accent:#7cff9e;--accent2:#58d679;--chip:rgba(124,255,158,.10);--shadow:0 12px 30px rgba(0,0,0,.70);}
html[data-theme="fallout"] body{font-family:var(--mono);text-shadow:0 0 6px rgba(124,255,158,.35);background:radial-gradient(circle at 50% 0%, rgba(124,255,158,.06), transparent 45%),var(--bg);}
html[data-theme="fallout"][data-fx="on"] body::before{content:"";position:fixed;inset:0;pointer-events:none;background:radial-gradient(circle at center, transparent 55%, rgba(0,0,0,.35) 100%);}
html[data-theme="fallout"][data-fx="on"] body::after{content:"";position:fixed;inset:0;pointer-events:none;background:repeating-linear-gradient(rgba(0,0,0,0.22) 0px,rgba(0,0,0,0.22) 2px,transparent 2px,transparent 5px);animation:scanMove 6s linear infinite;}
@keyframes scanMove{from{background-position:0 0;}to{background-position:0 120px;}}
*{box-sizing:border-box;}
body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Helvetica,Arial,sans-serif;}
header{padding:14px;background:var(--card);border-bottom:1px solid var(--border);position:sticky;top:0;z-index:5;}
h2,h3{margin:0 0 10px;}
small,.muted{color:var(--muted);}
.wrap{width:100%;max-width:1400px;margin:0 auto;padding:18px;}
@media (min-width:1200px){.wrap{max-width:1600px;padding:22px 28px;}}
.card{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:14px;margin-bottom:14px;box-shadow:var(--shadow);}
.row{display:flex;flex-wrap:wrap;gap:10px;align-items:center;}
.row.space{justify-content:space-between;}
button{padding:10px 14px;border-radius:10px;border:1px solid transparent;font-weight:900;cursor:pointer;background:var(--accent);color:var(--bg);margin:3px;}
button:hover{filter:brightness(1.03);}
button:active{transform:translateY(1px);}
button.alt{background:transparent;border:1px solid var(--border);color:var(--text);}
button.alt:hover{border-color:var(--accent2);}
button.tog.on{outline:2px solid var(--accent);}
button:disabled{opacity:.55;cursor:not-allowed;}
.pill{display:inline-block;padding:6px 10px;border-radius:999px;border:1px solid var(--border);background:var(--chip);font-weight:900;font-size:12px;}
.biggrid{display:grid;grid-template-columns:1fr 1fr;gap:14px;}
.bigbox{border:1px solid var(--border);border-radius:14px;padding:26px 16px;text-align:center;cursor:pointer;user-select:none;background:rgba(127,127,127,.05);}
.bigbox:hover{border-color:var(--accent2);}
.bigbox .title{font-size:22px;font-weight:1000;margin-bottom:6px;}
.bigbox .desc{color:var(--muted);font-size:13px;}
.choice{border:1px solid var(--border);padding:10px;border-radius:10px;margin-bottom:8px;cursor:pointer;background:rgba(127,127,127,.04);}
.choice:hover{border-color:rgba(127,127,127,.55);}
.choice .lbl{display:flex;gap:10px;align-items:flex-start;cursor:pointer;}
.choice input{margin-top:3px;transform:scale(1.12);}
.choice.disabled{opacity:.35;cursor:not-allowed;}
.choice.disabled:hover{border-color:var(--border);}
.navgrid{display:grid;grid-template-columns:repeat(10,1fr);gap:6px;margin-top:10px;}
.navbtn{border:1px solid var(--border);padding:8px;text-align:center;border-radius:8px;cursor:pointer;font-weight:900;background:rgba(127,127,127,.04);}
.navbtn.answered{background:rgba(34,197,94,.18);}
.navbtn.flagged{background:rgba(245,158,11,.20);}
.navbtn.current{outline:2px solid var(--accent);}
.flashcard{font-size:20px;padding:40px;text-align:center;border:1px solid var(--border);border-radius:12px;cursor:pointer;user-select:none;background:rgba(127,127,127,.04);}
table{width:100%;border-collapse:collapse;}
th,td{border:1px solid var(--border);padding:8px;vertical-align:top;font-size:13px;}
th{background:rgba(127,127,127,.08);text-align:left;}
select{padding:10px 12px;border-radius:10px;border:1px solid var(--border);background:var(--card);color:var(--text);font-weight:900;}
@media (max-width:720px){.biggrid{grid-template-columns:1fr;}}
@media (max-width:520px){.navgrid{grid-template-columns:repeat(8,1fr);}.flashcard{font-size:18px;padding:28px;}}
.boot{position:fixed;inset:0;background:#000;color:var(--text);display:flex;flex-direction:column;justify-content:center;align-items:center;z-index:999;padding:18px;text-align:center;}
.boot .title{font-size:22px;font-weight:1000;letter-spacing:.08em;}
.boot .line{margin-top:18px;font-size:14px;opacity:.9;}
.boot .hint{margin-top:18px;font-size:12px;opacity:.75;}
.boot .barWrap{width:min(520px,92vw);height:10px;border:1px solid var(--border);border-radius:999px;margin-top:18px;overflow:hidden;background:rgba(127,127,127,.08);}
.boot .bar{height:100%;width:0%;background:var(--accent);transition:width .2s ease;}
</style>
</head>
<body>
<div id="boot" class="boot" role="button" tabindex="0" aria-label="Boot screen (tap to skip)" onclick="skipBoot()" onkeydown="if(event.key==='Enter'||event.key===' ')skipBoot()">
  <div class="title">PIP-BOY OS v0.11</div>
  <div class="line" id="bootLine">Initializing…</div>
  <div class="barWrap"><div class="bar" id="bootBar"></div></div>
  <div class="hint">Tap / click to skip</div>
</div>

<header>
  <div class="row space">
    <div>
      <h2>PTCB Practice Test</h2>
      <div class="muted"><small>Single-file build (monster mode). Always 90 questions.</small></div>
    </div>
    <div class="row">
      <button class="alt" onclick="setTheme('amoled')">AMOLED</button>
      <button class="alt" onclick="setTheme('navy')">Navy</button>
      <button class="alt" onclick="setTheme('terminal')">Terminal</button>
      <button class="alt" onclick="setTheme('purple')">Purple</button>
      <button class="alt" onclick="setTheme('lab')">Lab</button>
      <button class="alt" onclick="setTheme('synthwave')">Synthwave</button>
      <button class="alt" onclick="setTheme('paper')">Paper</button>
      <button class="alt" onclick="setTheme('fallout')">Fallout</button>
      <button class="alt" onclick="toggleFX()">Fallout FX</button>
      <button class="alt" onclick="toggleSound()" id="soundBtn">UI Sounds</button>
    </div>
  </div>
</header>

<div class="wrap">
  <div id="menu" class="card" style="display:none;">
    <div class="biggrid">
      <div class="bigbox" onclick="startTest()">
        <div class="title">Practice Test</div>
        <div class="desc">Always 90 questions • flag toggle • 5 tips (50/50) • results breakdown</div>
      </div>
      <div class="bigbox" onclick="goFlashHome()">
        <div class="title">Flashcards</div>
        <div class="desc">Multiple flashcard sets for the PTCE</div>
      </div>
    </div>

    <div class="card" style="margin-top:14px;">
      <h3>Options</h3>
      <div class="row">
        <span class="pill"><label><input id="optTimed" type="checkbox" checked /> Timed</label></span>
        <span class="pill">Timer:
          <select id="timeSelect">
            <option value="110" selected>PTCE (110 min)</option>
            <option value="30">30 min</option>
            <option value="60">1 hour</option>
            <option value="90">1 hour 30 min</option>
            <option value="120">2 hours</option>
            <option value="150">2 hours 30 min</option>
          </select>
        </span>
        <span class="pill"><label><input id="optShuffleQ" type="checkbox" checked /> Shuffle questions</label></span>
        <span class="pill"><label><input id="optTips" type="checkbox" checked /> Tips enabled (5 per test)</label></span>
      </div>
      <div class="muted" style="margin-top:8px;">
        <small>Weighted split: <b>Med 32</b> • <b>Safety 21</b> • <b>Order 20</b> • <b>Federal 17</b> (Total 90).</small>
      </div>
      <div class="muted"><small id="status"></small></div>
    </div>
  </div>

  <div id="test" class="card" style="display:none;">
    <div class="row space">
      <div class="row">
        <span class="pill">Question <b id="qNum">1</b>/90</span>
        <span class="pill">Answered <b id="answeredCount">0</b></span>
        <span class="pill">Flagged <b id="flaggedCount">0</b></span>
        <span class="pill" id="domainPill">—</span>
        <span class="pill" id="tipsPill">Tips <b id="tipsLeft">5</b></span>
        <span class="pill" id="timerPill" style="display:none;">Time <b id="timerText">110:00</b></span>
      </div>
      <div class="row">
        <button onclick="submitTest()">Submit</button>
        <button class="alt" onclick="goMenu()">Main Menu</button>
      </div>
    </div>

    <h3 id="question" style="margin-top:12px;"></h3>
    <div id="choices"></div>

    <div class="row space">
      <div class="row">
        <button class="alt" onclick="prevQ()">Prev</button>
        <button onclick="nextQ()">Next</button>
        <button id="flagBtn" class="alt tog" onclick="toggleFlag()">Flag</button>
        <button id="tipBtn" class="alt" onclick="useTip()">Use Tip (50/50)</button>
      </div>
      <div class="muted"><small>Leave blank if you want. Submit anytime.</small></div>
    </div>

    <div id="nav" class="navgrid"></div>
  </div>

  <div id="results" class="card" style="display:none;">
    <div class="row space">
      <h3 style="margin:0;">Results</h3>
      <div class="row">
        <button onclick="restartTest()">Restart</button>
        <button class="alt" onclick="goMenu()">Main Menu</button>
      </div>
    </div>

    <div id="scoreSummary" class="card" style="margin-top:12px;"></div>

    <div class="card">
      <h3>Domain Breakdown</h3>
      <div id="domainBreakdown"></div>
    </div>

    <div class="card">
      <h3>Review</h3>
      <div class="muted"><small>Click a row to jump back into the test at that question.</small></div>
      <div style="overflow:auto; margin-top:10px;">
        <table>
          <thead>
            <tr>
              <th>#</th><th>Domain</th><th>Prompt</th><th>Your Answer</th><th>Correct</th><th>Status</th>
            </tr>
          </thead>
          <tbody id="reviewTable"></tbody>
        </table>
      </div>
    </div>
  </div>

  <div id="flashHome" class="card" style="display:none;">
    <div class="row space">
      <h3 style="margin:0;">Flashcards</h3>
      <button class="alt" onclick="goMenu()">Main Menu</button>
    </div>
    <div class="row" style="margin-top:10px;">
      <button onclick="openFlash('MED')">Medications</button>
      <button onclick="openFlash('SAFE')">Patient Safety</button>
      <button onclick="openFlash('ORDER')">Order Entry / Math</button>
      <button onclick="openFlash('FED')">Federal</button>
      <button class="alt" onclick="openFlash('MIX')">Mixed</button>
    </div>
    <div class="muted" style="margin-top:10px;"><small>Tap the flashcard to flip.</small></div>
  </div>

  <div id="flash" class="card" style="display:none;">
    <div class="row space">
      <div class="row">
        <span class="pill">Deck <b id="flashDeckName">—</b></span>
        <span class="pill">Card <b id="flashPos">1</b>/<b id="flashTotal">1</b></span>
        <span class="pill">Side <b id="flashSide">Front</b></span>
      </div>
      <div class="row">
        <button onclick="nextFlash()">Next</button>
        <button class="alt" onclick="goFlashHome()">Decks</button>
        <button class="alt" onclick="goMenu()">Main Menu</button>
      </div>
    </div>
    <div id="flashCard" class="flashcard" style="margin-top:12px;">Tap to Flip</div>
  </div>

</div>

<script>
/* BOOT */
const bootLines = ["VAULT-TEC DIAGNOSTICS… OK","Loading medication index…","Loading safety module…","Loading order processing…","Loading federal requirements…","Initializing UI…","System ready."];
let bootIndex=0, bootDone=false;
let bootTimer=setInterval(()=>{ if(bootDone) return; document.getElementById("bootLine").textContent=bootLines[Math.min(bootIndex,bootLines.length-1)];
  const pct=Math.min(100, Math.round((bootIndex+1)/bootLines.length*100)); document.getElementById("bootBar").style.width=pct+"%"; bootIndex++;
  if(bootIndex>=bootLines.length){ setTimeout(skipBoot,450); } }, 420);
function skipBoot(){ if(bootDone) return; bootDone=true; clearInterval(bootTimer); document.getElementById("boot").style.display="none"; document.getElementById("menu").style.display=""; }

/* THEME + FX + SOUND */
function setTheme(t){ document.documentElement.setAttribute("data-theme", t); localStorage.setItem("theme", t); }
function toggleFX(){ const el=document.documentElement; const next=(el.getAttribute("data-fx")==="on")?"off":"on"; el.setAttribute("data-fx", next); localStorage.setItem("fx", next); }
let soundEnabled=true; function toggleSound(){ soundEnabled=!soundEnabled; localStorage.setItem("sound", soundEnabled?"on":"off"); document.getElementById("soundBtn").classList.toggle("on", soundEnabled); }
let audioCtx=null;
function beep(freq=700,duration=0.045){ if(!soundEnabled) return; try{ if(!audioCtx) audioCtx=new (window.AudioContext||window.webkitAudioContext)();
  const osc=audioCtx.createOscillator(); const gain=audioCtx.createGain(); osc.type="square"; osc.frequency.value=freq; gain.gain.value=0.03;
  osc.connect(gain); gain.connect(audioCtx.destination); osc.start(); osc.stop(audioCtx.currentTime+duration); }catch(e){} }
(function initPrefs(){ const t=localStorage.getItem("theme"); if(t) document.documentElement.setAttribute("data-theme", t);
  const fx=localStorage.getItem("fx"); if(fx) document.documentElement.setAttribute("data-fx", fx);
  const snd=localStorage.getItem("sound"); if(snd==="off") soundEnabled=false; document.getElementById("soundBtn").classList.toggle("on", soundEnabled); })();

/* CONFIG */
const DOMAIN={ MED:"Medications", SAFE:"Patient Safety", ORDER:"Order Entry / Math", FED:"Federal Requirements" };
const COUNTS={ MED:32, SAFE:21, ORDER:20, FED:17 };
const TOTAL=90;

/* STATE */
let questions=[]; let answers=new Map(); let flags=new Set(); let idx=0;
let timer=null, timed=true, timeLeft=110*60;
let tipsEnabled=true, tipsRemaining=5; let eliminated=new Map();

const statusEl=document.getElementById("status");

/* DATA BANKS */
const GENERIC_SEEDS = [
  "acetaminophen",
  "ibuprofen",
  "naproxen",
  "aspirin",
  "diclofenac",
  "meloxicam",
  "amoxicillin",
  "amoxicillin/clavulanate",
  "cephalexin",
  "cefuroxime",
  "cefdinir",
  "ceftriaxone",
  "azithromycin",
  "clarithromycin",
  "doxycycline",
  "minocycline",
  "clindamycin",
  "metronidazole",
  "ciprofloxacin",
  "levofloxacin",
  "trimethoprim/sulfamethoxazole",
  "fluconazole",
  "terbinafine",
  "nystatin",
  "acyclovir",
  "valacyclovir",
  "oseltamivir",
  "albuterol",
  "ipratropium",
  "tiotropium",
  "fluticasone",
  "budesonide",
  "mometasone",
  "montelukast",
  "lisinopril",
  "enalapril",
  "losartan",
  "valsartan",
  "olmesartan",
  "amlodipine",
  "diltiazem",
  "verapamil",
  "metoprolol",
  "atenolol",
  "carvedilol",
  "propranolol",
  "hydrochlorothiazide",
  "chlorthalidone",
  "furosemide",
  "spironolactone",
  "atorvastatin",
  "rosuvastatin",
  "simvastatin",
  "pravastatin",
  "metformin",
  "glipizide",
  "glyburide",
  "sitagliptin",
  "empagliflozin",
  "insulin glargine",
  "levothyroxine",
  "methimazole",
  "omeprazole",
  "pantoprazole",
  "esomeprazole",
  "famotidine",
  "sertraline",
  "fluoxetine",
  "escitalopram",
  "citalopram",
  "venlafaxine",
  "duloxetine",
  "gabapentin",
  "pregabalin",
  "sumatriptan",
  "ondansetron",
  "tamsulosin",
  "sildenafil",
  "warfarin",
  "apixaban",
  "rivaroxaban",
  "clopidogrel",
  "prednisone",
  "methylprednisolone",
  "hydrocodone/acetaminophen",
  "oxycodone/acetaminophen",
  "cyclobenzaprine",
  "diphenhydramine",
  "cetirizine",
  "loratadine",
  "fexofenadine",
  "polyethylene glycol 3350",
  "docusate",
  "senna",
  "bupropion",
  "trazodone",
  "allopurinol",
  "finasteride",
  "ketorolac",
  "nitroglycerin",
  "metoclopramide",
  "lactulose",
  "clonazepam",
  "alprazolam",
  "diazepam",
  "zolpidem",
  "amiodarone",
  "famciclovir",
  "triamcinolone",
  "ketoconazole",
  "linezolid",
  "vancomycin",
  "insulin lispro",
  "norethindrone",
  "ethinyl estradiol/levonorgestrel",
  "vitamin d (cholecalciferol)",
  "ferrous sulfate",
  "cyanocobalamin",
  "folic acid"
];
const BRAND_PAIRS = [
  [
    "atorvastatin",
    [
      "Lipitor"
    ]
  ],
  [
    "rosuvastatin",
    [
      "Crestor"
    ]
  ],
  [
    "simvastatin",
    [
      "Zocor"
    ]
  ],
  [
    "pravastatin",
    [
      "Pravachol"
    ]
  ],
  [
    "lisinopril",
    [
      "Prinivil",
      "Zestril"
    ]
  ],
  [
    "losartan",
    [
      "Cozaar"
    ]
  ],
  [
    "valsartan",
    [
      "Diovan"
    ]
  ],
  [
    "amlodipine",
    [
      "Norvasc"
    ]
  ],
  [
    "metoprolol",
    [
      "Lopressor",
      "Toprol XL"
    ]
  ],
  [
    "carvedilol",
    [
      "Coreg"
    ]
  ],
  [
    "metformin",
    [
      "Glucophage"
    ]
  ],
  [
    "levothyroxine",
    [
      "Synthroid",
      "Levoxyl"
    ]
  ],
  [
    "omeprazole",
    [
      "Prilosec"
    ]
  ],
  [
    "pantoprazole",
    [
      "Protonix"
    ]
  ],
  [
    "sertraline",
    [
      "Zoloft"
    ]
  ],
  [
    "fluoxetine",
    [
      "Prozac"
    ]
  ],
  [
    "escitalopram",
    [
      "Lexapro"
    ]
  ],
  [
    "gabapentin",
    [
      "Neurontin"
    ]
  ],
  [
    "pregabalin",
    [
      "Lyrica"
    ]
  ],
  [
    "sumatriptan",
    [
      "Imitrex"
    ]
  ],
  [
    "ondansetron",
    [
      "Zofran"
    ]
  ],
  [
    "tamsulosin",
    [
      "Flomax"
    ]
  ],
  [
    "sildenafil",
    [
      "Viagra"
    ]
  ],
  [
    "warfarin",
    [
      "Coumadin"
    ]
  ],
  [
    "clopidogrel",
    [
      "Plavix"
    ]
  ],
  [
    "apixaban",
    [
      "Eliquis"
    ]
  ],
  [
    "rivaroxaban",
    [
      "Xarelto"
    ]
  ],
  [
    "albuterol",
    [
      "Ventolin",
      "ProAir"
    ]
  ],
  [
    "fluticasone",
    [
      "Flonase"
    ]
  ],
  [
    "acetaminophen",
    [
      "Tylenol"
    ]
  ],
  [
    "ibuprofen",
    [
      "Advil",
      "Motrin"
    ]
  ],
  [
    "diphenhydramine",
    [
      "Benadryl"
    ]
  ],
  [
    "cetirizine",
    [
      "Zyrtec"
    ]
  ],
  [
    "loratadine",
    [
      "Claritin"
    ]
  ],
  [
    "fexofenadine",
    [
      "Allegra"
    ]
  ],
  [
    "polyethylene glycol 3350",
    [
      "MiraLAX"
    ]
  ],
  [
    "bupropion",
    [
      "Wellbutrin"
    ]
  ],
  [
    "trazodone",
    [
      "Desyrel"
    ]
  ],
  [
    "allopurinol",
    [
      "Zyloprim"
    ]
  ],
  [
    "nitroglycerin",
    [
      "Nitrostat"
    ]
  ],
  [
    "metoclopramide",
    [
      "Reglan"
    ]
  ],
  [
    "zolpidem",
    [
      "Ambien"
    ]
  ],
  [
    "amoxicillin",
    [
      "Amoxil"
    ]
  ],
  [
    "cephalexin",
    [
      "Keflex"
    ]
  ],
  [
    "azithromycin",
    [
      "Zithromax"
    ]
  ],
  [
    "doxycycline",
    [
      "Vibramycin"
    ]
  ],
  [
    "fluconazole",
    [
      "Diflucan"
    ]
  ],
  [
    "valacyclovir",
    [
      "Valtrex"
    ]
  ],
  [
    "oseltamivir",
    [
      "Tamiflu"
    ]
  ],
  [
    "methylprednisolone",
    [
      "Medrol"
    ]
  ],
  [
    "prednisone",
    [
      "Deltasone"
    ]
  ],
  [
    "cyclobenzaprine",
    [
      "Flexeril"
    ]
  ]
];
const SUFFIX_RULES = [
  [
    "-pril",
    "ACE inhibitor"
  ],
  [
    "-sartan",
    "ARB"
  ],
  [
    "-olol",
    "beta blocker"
  ],
  [
    "-statin",
    "statin"
  ],
  [
    "-prazole",
    "proton pump inhibitor"
  ],
  [
    "-cycline",
    "tetracycline antibiotic"
  ],
  [
    "-azole",
    "antifungal"
  ],
  [
    "-vir",
    "antiviral"
  ],
  [
    "-setron",
    "antiemetic (5-HT3 antagonist)"
  ],
  [
    "-caine",
    "local anesthetic"
  ],
  [
    "-pam / -lam",
    "benzodiazepine (common fragments)"
  ]
];
const CONVERSIONS = [
  [
    "1 g equals:",
    "1000 mg"
  ],
  [
    "1 mg equals:",
    "1000 mcg"
  ],
  [
    "1 kg equals:",
    "1000 g"
  ],
  [
    "lb → kg conversion:",
    "kg = lb ÷ 2.2"
  ],
  [
    "1 tsp equals:",
    "5 mL"
  ],
  [
    "1 tbsp equals:",
    "15 mL"
  ],
  [
    "30 mL is approximately:",
    "1 fl oz"
  ]
];
const DEA_FORMS = [
  [
    "DEA Form 222",
    "Ordering Schedule II controlled substances"
  ],
  [
    "DEA Form 106",
    "Report theft/significant loss of controlled substances"
  ],
  [
    "DEA Form 41",
    "Documentation for destruction/disposal of controlled substances"
  ],
  [
    "DEA Form 224",
    "Controlled substance registration"
  ]
];
const USP_CHAPTERS = [
  [
    "USP <795>",
    "Non-sterile compounding"
  ],
  [
    "USP <797>",
    "Sterile compounding"
  ],
  [
    "USP <800>",
    "Hazardous drug handling and safety"
  ]
];

/* HELPERS */
function shuffle(arr){ for(let i=arr.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [arr[i],arr[j]]=[arr[j],arr[i]]; } return arr; }
function pick(arr){ return arr[Math.floor(Math.random()*arr.length)]; }
function uniqBy(arr, keyFn){ const seen=new Set(); const out=[]; for(const x of arr){ const k=keyFn(x); if(seen.has(k)) continue; seen.add(k); out.push(x);} return out; }
function stripHtml(s){ return String(s).replace(/<[^>]*>/g,"").trim(); }
function htmlEscape(s){ return String(s).replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;"); }
function fmtTime(sec){ const m=Math.floor(sec/60); const s=sec%60; return `${m}:${String(s).padStart(2,"0")}`; }
function setView(view){ const ids=["menu","test","results","flashHome","flash"]; for(const id of ids){ document.getElementById(id).style.display=(id===view)?"":"none"; } }
function hashId(str){ let h=2166136261; for(let i=0;i<str.length;i++){ h^=str.charCodeAt(i); h=Math.imul(h,16777619);} return "q"+(h>>>0).toString(16); }
function makeFixed(domain, stem, correct, wrongs){ const choices=shuffle([correct,...wrongs]).slice(0,4); const answerIndex=choices.findIndex(x=>stripHtml(x)===stripHtml(correct));
  const id=hashId(domain+"|"+stripHtml(stem)+"|"+stripHtml(correct)); return {domain, stemHTML:stem, choices, answerIndex:Math.max(0,answerIndex), id}; }

/* POOL BUILDERS */
function buildMedicationPool(){
  const out=[];
  const generics=BRAND_PAIRS.map(x=>x[0]);
  const allBrands=uniqBy(BRAND_PAIRS.flatMap(x=>x[1]), x=>x.toLowerCase());

  for(const [g, brands] of BRAND_PAIRS){
    out.push(makeFixed(DOMAIN.MED, `Which brand name corresponds to the generic <b>${htmlEscape(g)}</b>?`, pick(brands),
      shuffle(allBrands.filter(b=>!brands.map(x=>x.toLowerCase()).includes(b.toLowerCase()))).slice(0,3)));
    for(const b of brands){
      out.push(makeFixed(DOMAIN.MED, `Which generic corresponds to the brand <b>${htmlEscape(b)}</b>?`, g,
        shuffle(generics.filter(x=>x.toLowerCase()!==g.toLowerCase())).slice(0,3)));
    }
  }

  for(const [suffix, cls] of SUFFIX_RULES){
    const wrong=shuffle(SUFFIX_RULES.filter(x=>x[0]!==suffix).map(x=>x[0])).slice(0,3);
    out.push(makeFixed(DOMAIN.MED, `Which suffix most commonly suggests a <b>${htmlEscape(cls)}</b>?`, suffix, wrong));
  }

  out.push(makeFixed(DOMAIN.MED, "Which medication class is commonly considered high-alert due to risk of severe harm if misused?", "Insulins",
    ["Stool softeners","Topical antifungals","Intranasal steroids"]));

  for(let k=0;k<320;k++){
    const g=pick(GENERIC_SEEDS);
    const stem="Which of the following is written as a <b>generic</b> medication name?";
    const wrong=shuffle(BRAND_PAIRS.flatMap(x=>x[1])).slice(0,3);
    out.push(makeFixed(DOMAIN.MED, stem, g, wrong));
  }
  return uniqBy(out, q=>q.id);
}

function buildSafetyPool(){
  const out=[];
  for(const [chap, topic] of USP_CHAPTERS){
    const wrong=shuffle(USP_CHAPTERS.filter(x=>x[0]!==chap).map(x=>x[1])).slice(0,3);
    out.push(makeFixed(DOMAIN.SAFE, `What does <b>${htmlEscape(chap)}</b> primarily cover?`, topic, wrong));
  }
  const fixed=[
    ["LASA stands for:", "Look-alike / sound-alike", ["Long-acting / short-acting","Label-and-store-always","Lot-and-serial-audit"]],
    ["Best practice: leading zero is:", "Write 0.5 mg (not .5 mg)", ["Write .5 mg only","Write 5.0 mg","Avoid decimals completely"]],
    ["Best practice: trailing zero is:", "Avoid 5.0 mg; write 5 mg", ["Always write 5.0 mg","Write 5.00 mg","Use commas instead"]],
    ["If a dose looks clinically unsafe, a technician should:", "Refer to the pharmacist for review", ["Change the dose","Fill as written","Call insurance first"]],
    ["FDA MedWatch is used to report:", "Serious adverse events/product quality problems", ["Theft/loss to DEA","HIPAA violations","Prior authorization requests"]],
    ["Tall-man lettering is used to:", "Reduce look-alike confusion", ["Increase reimbursement","Replace NDC","Mark controlled drugs only"]],
    ["First step in garbing (best practice) is typically:", "Hand hygiene", ["Don gloves","Apply shoe covers","Put on outer gown"]],
  ];
  for(const x of fixed){ out.push(makeFixed(DOMAIN.SAFE, x[0], x[1], x[2])); }

  const safe_actions=[
    ["Clarify illegible or incomplete prescriptions with the pharmacist/prescriber","Enter anyway and hope for the best"],
    ["Verify patient identifiers before processing","Use the last patient profile opened"],
    ["Use barcode scanning when available","Rely solely on bottle color/shape"],
    ["Follow beyond-use dating and labeling rules","Estimate dating from memory"],
    ["Document and report errors/near-misses per policy","Hide errors to avoid trouble"],
  ];
  for(let i=0;i<200;i++){
    const [good,bad]=pick(safe_actions);
    out.push(makeFixed(DOMAIN.SAFE,"Which action is the safest and most appropriate?",good,
      shuffle([bad,"Override system warnings without review","Skip double-checks on high-alert meds"])));
  }
  return uniqBy(out, q=>q.id);
}

function buildFederalPool(){
  const out=[];
  for(const [form, use] of DEA_FORMS){
    const wrong=shuffle(DEA_FORMS.filter(x=>x[0]!==form).map(x=>x[0])).slice(0,3);
    out.push(makeFixed(DOMAIN.FED, `Which form matches: <b>${htmlEscape(use)}</b>?`, form, wrong));
  }
  const fixed=[
    ["Schedule II prescriptions federally:", "Cannot be refilled", ["Up to 5 refills in 6 months","Unlimited refills","Refill if pharmacist approves"]],
    ["Typical federal rule for Schedule III–V refills:", "Up to 5 refills within 6 months", ["Unlimited refills","No refills allowed","Exactly 2 refills"]],
    ["HIPAA primarily protects:", "Patient health information privacy", ["Drug pricing rules","DEA scheduling","NDC formatting"]],
    ["HIPAA 'minimum necessary' means:", "Only disclose PHI needed for the task", ["Always disclose full profile","Never disclose any PHI","Only pharmacists can see PHI"]],
    ["DSCSA mainly addresses:", "Drug supply chain security/traceability", ["Only controlled diversion","Insurance formularies","Patient counseling"]],
  ];
  for(const x of fixed){ out.push(makeFixed(DOMAIN.FED, x[0], x[1], x[2])); }

  const retention=[
    ["Follow state/federal record retention policies and site SOPs","Throw away controlled records after 30 days"],
    ["Secure controlled substances and limit access","Store controls in an unlocked bin"],
    ["Report significant loss/theft per policy promptly","Wait until the next inventory cycle"],
  ];
  for(let i=0;i<180;i++){
    const [good,bad]=pick(retention);
    out.push(makeFixed(DOMAIN.FED,"Which action best aligns with controlled substance compliance principles?",good,
      shuffle([bad,"Share passwords to save time","Backdate records to match inventory"])));
  }
  return uniqBy(out, q=>q.id);
}

function buildOrderPool(){
  const out=[];
  for(const [q,a] of CONVERSIONS){
    const wrong=shuffle(CONVERSIONS.map(x=>x[1]).filter(x=>x!==a)).slice(0,3);
    out.push(makeFixed(DOMAIN.ORDER, q, a, wrong));
  }

  function genDaysSupply(){
    const perDay=pick([1,2,3,4]); const days=pick([7,10,14,30]); const qty=perDay*days;
    const freq=perDay===1?"once daily":perDay===2?"BID":perDay===3?"TID":"QID";
    const stem=`Rx: Take 1 tablet <b>${freq}</b> for <b>${days} days</b>. What quantity is needed?`;
    return makeFixed(DOMAIN.ORDER, stem, `${qty} tablets`, [`${days} tablets`,`${qty+perDay} tablets`,`${Math.max(1,qty-perDay)} tablets`]);
  }
  function genMLDose(){
    const conc=pick([100,125,200,250]); const dose=pick([100,150,200,250,300,400]);
    const ml=Math.round((dose*5/conc)*10)/10;
    const stem=`Liquid concentration: <b>${conc} mg / 5 mL</b>. Ordered dose: <b>${dose} mg</b>. How many mL per dose?`;
    const wrong=shuffle([`${Math.round(ml*2*10)/10} mL`,`${Math.max(0.5,Math.round(ml/2*10)/10)} mL`,`${dose} mL`]).slice(0,3);
    return makeFixed(DOMAIN.ORDER, stem, `${ml} mL`, wrong);
  }
  function genPeds(){
    const lb=pick([22,33,44,55,66,77,88,99]); const kg=Math.round(lb/2.2);
    const mgkg=pick([5,10,15,20,25]); const doses=pick([2,3,4]);
    const daily=kg*mgkg; const perDose=Math.round(daily/doses);
    const stem=`Scenario: Child weighs <b>${lb} lb</b> (round to nearest kg). Rx: <b>${mgkg} mg/kg/day</b> divided <b>${doses} doses/day</b>. What is <b>mg per dose</b>?`;
    return makeFixed(DOMAIN.ORDER, stem, `${perDose} mg per dose`, [`${daily} mg per dose`,`${Math.max(1,Math.round(perDose/2))} mg per dose`,`${perDose*2} mg per dose`]);
  }
  function genIV(){
    const vol=pick([250,500,750,1000,1250]); const hrs=pick([2,4,6,8,10]); const rate=Math.round(vol/hrs);
    const stem=`IV infusion: <b>${vol} mL</b> over <b>${hrs} hours</b>. What is the rate (mL/hr)?`;
    return makeFixed(DOMAIN.ORDER, stem, `${rate} mL/hr`, [`${vol} mL/hr`,`${hrs} mL/hr`,`${Math.round(rate*1.5)} mL/hr`]);
  }

  const rejections=[
    ["Refill too soon","Verify last fill date and days supply before contacting insurance"],
    ["Prior authorization required","Inform patient/prescriber that plan needs approval; pharmacist initiates PA process"],
    ["Non-formulary / not covered","Check covered alternatives or follow formulary exception workflow per policy"],
    ["Incorrect ID / group","Verify patient insurance information and rebill"],
  ];
  for(const [rej,best] of rejections){
    out.push(makeFixed(DOMAIN.ORDER, `Insurance rejects: <b>${htmlEscape(rej)}</b>. Best next step?`, best,
      shuffle(["Dispense without billing and hope it gets paid later","Change medication without pharmacist/prescriber","Ignore and mark as sold"])));
  }

  for(let i=0;i<260;i++){
    const r=Math.random();
    out.push(r<0.25?genDaysSupply():r<0.5?genMLDose():r<0.75?genPeds():genIV());
  }

  out.push(makeFixed(DOMAIN.ORDER, "DAW indicates:", "Dispense As Written/substitution instruction",
    ["Drug assay weight","Dose after withdrawal","DEA audit window"]));

  return uniqBy(out, q=>q.id);
}

/* BUILD EXAM GUARANTEED 90 */
function takeNFromPool(pool,n){ const out=[]; if(!pool||pool.length===0) return out; let k=0; while(out.length<n){ out.push(pool[k%pool.length]); k++; } return out; }
function buildExam(){
  statusEl.textContent="Building question set…";
  const med=buildMedicationPool(), safe=buildSafetyPool(), order=buildOrderPool(), fed=buildFederalPool();
  shuffle(med); shuffle(safe); shuffle(order); shuffle(fed);
  let exam=[].concat(takeNFromPool(med,COUNTS.MED), takeNFromPool(safe,COUNTS.SAFE), takeNFromPool(order,COUNTS.ORDER), takeNFromPool(fed,COUNTS.FED));
  const all=med.concat(safe,order,fed);
  while(exam.length<TOTAL){ exam.push(all[Math.floor(Math.random()*all.length)]); }
  exam=exam.slice(0,TOTAL);
  if(document.getElementById("optShuffleQ").checked) shuffle(exam);
  questions=exam;
  if(questions.length!==TOTAL) console.error("Exam build length error:", questions.length);
  statusEl.textContent="";
}

/* TIMER */
function startTimer(){ stopTimer(); document.getElementById("timerPill").style.display=timed?"":"none"; document.getElementById("timerText").textContent=fmtTime(timeLeft);
  if(!timed) return; timer=setInterval(()=>{ timeLeft--; document.getElementById("timerText").textContent=fmtTime(Math.max(0,timeLeft)); if(timeLeft<=0){ stopTimer(); submitTest(true); } }, 1000); }
function stopTimer(){ if(timer){ clearInterval(timer); timer=null; } }

/* TIP */
function useTip(){
  if(!tipsEnabled || tipsRemaining<=0 || eliminated.has(idx)) return;
  beep(1200,0.08);
  const q=questions[idx];
  const wrong=[0,1,2,3].filter(i=>i!==q.answerIndex);
  shuffle(wrong);
  eliminated.set(idx, new Set([wrong[0], wrong[1]]));
  tipsRemaining--;
  const a=answers.get(idx); if(a!==undefined && eliminated.get(idx).has(a)) answers.delete(idx);
  updateTop(); renderQuestion();
}

/* UI UPDATES */
function updateTop(){
  document.getElementById("qNum").textContent=String(idx+1);
  document.getElementById("answeredCount").textContent=String(answers.size);
  document.getElementById("flaggedCount").textContent=String(flags.size);
  document.getElementById("domainPill").textContent=questions[idx]?.domain||"—";
  const fb=document.getElementById("flagBtn");
  fb.classList.toggle("on", flags.has(idx)); fb.textContent=flags.has(idx)?"Flagged":"Flag";
  document.getElementById("tipsLeft").textContent=String(tipsRemaining);
  document.getElementById("tipsPill").style.display=tipsEnabled?"":"none";
  const tipBtn=document.getElementById("tipBtn");
  tipBtn.style.display=tipsEnabled?"":"none";
  tipBtn.disabled=!tipsEnabled || tipsRemaining<=0 || eliminated.has(idx);
  tipBtn.textContent=eliminated.has(idx)?"Tip Used":"Use Tip (50/50)";
}

/* RENDER */
function renderNav(){
  document.getElementById("nav").innerHTML=questions.map((_,i)=>{
    const cls=["navbtn", answers.has(i)?"answered":"", flags.has(i)?"flagged":"", i===idx?"current":""].join(" ");
    return `<div class="${cls}" onclick="gotoQ(${i})">${i+1}</div>`;
  }).join("");
}
function renderQuestion(){
  const q=questions[idx]; updateTop();
  document.getElementById("question").innerHTML=q.stemHTML;
  const selected=answers.get(idx);
  const groupName=`q_${idx}`;
  const elim=eliminated.get(idx)||new Set();
  document.getElementById("choices").innerHTML=q.choices.map((c,i)=>{
    const checked=(selected===i)?"checked":"";
    const isDisabled=elim.has(i);
    const disAttr=isDisabled?"disabled":"";
    const disClass=isDisabled?"disabled":"";
    const click=isDisabled?"":`onclick="selectAnswer(${idx},${i})"`;
    return `<div class="choice ${disClass}" ${click}>
      <label class="lbl">
        <input type="radio" name="${groupName}" ${checked} ${disAttr} onchange="selectAnswer(${idx},${i})" />
        <div>${c}</div>
      </label>
    </div>`;
  }).join("");
  renderNav();
}
function selectAnswer(qIndex, choiceIndex){ const elim=eliminated.get(qIndex); if(elim && elim.has(choiceIndex)) return; answers.set(qIndex, choiceIndex); beep(700,0.03); updateTop(); renderNav(); }
function gotoQ(i){ idx=i; beep(900,0.04); renderQuestion(); }
function nextQ(){ if(idx<TOTAL-1){ idx++; beep(900,0.04); renderQuestion(); } }
function prevQ(){ if(idx>0){ idx--; beep(500,0.04); renderQuestion(); } }
function toggleFlag(){ beep(620,0.03); if(flags.has(idx)) flags.delete(idx); else flags.add(idx); updateTop(); renderNav(); }

/* RESULTS */
function submitTest(fromTimer=false){
  beep(300,0.15); stopTimer();
  let correct=0, incorrect=0, blank=0;
  const domainStats={{ [DOMAIN.MED]:{{total:0,correct:0}}, [DOMAIN.SAFE]:{{total:0,correct:0}}, [DOMAIN.ORDER]:{{total:0,correct:0}}, [DOMAIN.FED]:{{total:0,correct:0}} }};
  for(let i=0;i<questions.length;i++){
    const q=questions[i]; domainStats[q.domain].total++;
    const a=answers.get(i);
    if(a===undefined){ blank++; continue; }
    if(a===q.answerIndex){ correct++; domainStats[q.domain].correct++; } else incorrect++;
  }
  const pct=Math.round((correct/TOTAL)*100);
  const timeMsg=fromTimer? "<span class='pill'>Time expired</span>":"";
  document.getElementById("scoreSummary").innerHTML=`<div class="row space"><div class="row">
    <span class="pill">Score <b>${correct}</b>/<b>${TOTAL}</b> (<b>${pct}%</b>)</span>
    <span class="pill">Incorrect <b>${incorrect}</b></span>
    <span class="pill">Blank <b>${blank}</b></span>${timeMsg}
  </div><div class="muted"><small>Review flagged + incorrect first.</small></div></div>`;
  const bd=[];
  for(const k of [DOMAIN.MED, DOMAIN.SAFE, DOMAIN.ORDER, DOMAIN.FED]){
    const st=domainStats[k]; const p=st.total?Math.round((st.correct/st.total)*100):0;
    bd.push(`<span class="pill">${k}: <b>${st.correct}</b>/<b>${st.total}</b> (${p}%)</span>`);
  }
  document.getElementById("domainBreakdown").innerHTML=`<div class="row">${bd.join("")}</div>`;
  const tbody=document.getElementById("reviewTable"); tbody.innerHTML="";
  for(let i=0;i<questions.length;i++){
    const q=questions[i]; const a=answers.get(i);
    const your=(a===undefined)?"(blank)":stripHtml(q.choices[a]);
    const corr=stripHtml(q.choices[q.answerIndex]);
    const status=(a===undefined)?"Blank":(a===q.answerIndex?"Correct":"Incorrect");
    const statusColor=(status==="Correct")?"color:var(--good)":(status==="Incorrect")?"color:var(--bad)":"color:var(--warn)";
    const shortPrompt=stripHtml(q.stemHTML).slice(0,120)+(stripHtml(q.stemHTML).length>120?"…":"");
    const tr=document.createElement("tr"); tr.style.cursor="pointer";
    tr.onclick=()=>{ setView("test"); idx=i; renderQuestion(); };
    tr.innerHTML=`<td>${i+1}</td><td>${q.domain}</td><td>${htmlEscape(shortPrompt)}</td><td>${htmlEscape(your)}</td><td>${htmlEscape(corr)}</td>
      <td style="${statusColor};font-weight:1000;">${status}${flags.has(i)?" (flagged)":""}</td>`;
    tbody.appendChild(tr);
  }
  setView("results");
}

/* MENU FLOW */
function startTest(){
  setView("test");
  timed=document.getElementById("optTimed").checked;
  const minutes=parseInt(document.getElementById("timeSelect").value,10);
  timeLeft=minutes*60;
  tipsEnabled=document.getElementById("optTips").checked;
  tipsRemaining=tipsEnabled?5:0;
  eliminated=new Map(); answers=new Map(); flags=new Set(); idx=0;
  document.getElementById("question").textContent="Loading questions…";
  buildExam(); startTimer(); updateTop(); renderQuestion();
}
function restartTest(){ startTest(); }
function goMenu(){ stopTimer(); statusEl.textContent=""; setView("menu"); }

/* FLASHCARDS */
let flashDeck=[]; let flashDeckName=""; let fIndex=0; let fFront=true;
function goFlashHome(){ stopTimer(); setView("flashHome"); }
function buildFlashDeck(type){
  const cards=[];
  for(const [g, brands] of BRAND_PAIRS){ cards.push({deck:"MED", front:`Brand for: ${g}`, back:brands.join(", ")});
    for(const b of brands) cards.push({deck:"MED", front:`Generic for: ${b}`, back:g}); }
  for(const [suffix, cls] of SUFFIX_RULES){ cards.push({deck:"MED", front:`Suffix ${suffix} suggests`, back:cls}); }
  for(const [chap, topic] of USP_CHAPTERS){ cards.push({deck:"SAFE", front:`${chap}`, back:topic}); }
  cards.push({deck:"SAFE", front:"Leading zero", back:"Use 0.5 (not .5)"}); cards.push({deck:"SAFE", front:"Trailing zero", back:"Avoid 5.0; write 5"});
  for(const [q,a] of CONVERSIONS){ cards.push({deck:"ORDER", front:q, back:a}); }
  cards.push({deck:"ORDER", front:"DAW", back:"Dispense As Written (substitution instruction)"});
  for(const [form, use] of DEA_FORMS){ cards.push({deck:"FED", front:form, back:use}); }
  cards.push({deck:"FED", front:"HIPAA", back:"Protects PHI; minimum necessary standard"}); cards.push({deck:"FED", front:"DSCSA", back:"Supply chain traceability/security"});
  let deck=(type==="MIX")?cards:cards.filter(c=>c.deck===type);
  flashDeck=shuffle(deck.slice());
  flashDeckName= type==="MED"?"Medications":type==="SAFE"?"Patient Safety":type==="ORDER"?"Order Entry / Math":type==="FED"?"Federal":"Mixed";
  fIndex=0; fFront=true;
}
function openFlash(type){ beep(880,0.04); setView("flash"); buildFlashDeck(type); document.getElementById("flashDeckName").textContent=flashDeckName; renderFlash(); }
function renderFlash(){
  const total=Math.max(1,flashDeck.length);
  const card=flashDeck[fIndex]||{front:"No cards",back:"—"};
  document.getElementById("flashPos").textContent=String(fIndex+1);
  document.getElementById("flashTotal").textContent=String(total);
  document.getElementById("flashSide").textContent=fFront?"Front":"Back";
  document.getElementById("flashCard").textContent=fFront?card.front:card.back;
}
document.getElementById("flashCard").onclick=()=>{ beep(740,0.03); fFront=!fFront; renderFlash(); };
function nextFlash(){ beep(900,0.04); if(!flashDeck.length) return; fIndex=(fIndex+1)%flashDeck.length; fFront=true; renderFlash(); }

/* INIT */
setView("menu");
</script>
</body>
</html>
