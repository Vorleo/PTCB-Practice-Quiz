<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>PTCB Ultimate Practice Exam</title>

<style>
body{font-family:system-ui;margin:0;background:#f4f6fb}
header{background:#111827;color:#fff;padding:16px}
.wrap{max-width:1100px;margin:auto;padding:16px}
.card{background:#fff;padding:16px;border-radius:14px;box-shadow:0 6px 20px rgba(0,0,0,.08);margin-bottom:16px}
button{background:#111827;color:white;border:none;padding:10px 14px;border-radius:10px;cursor:pointer;font-weight:600}
.choice{border:1px solid #e5e7eb;padding:12px;border-radius:10px;margin-bottom:8px;cursor:pointer}
.choice:hover{background:#eef2ff}
.navgrid{display:grid;grid-template-columns:repeat(10,1fr);gap:6px;margin-top:12px}
.navbtn{padding:8px;border-radius:8px;border:1px solid #ddd;background:white;font-size:12px;cursor:pointer}
.navbtn.answered{background:#dcfce7}
.navbtn.flagged{background:#ffedd5}
.navbtn.current{outline:2px solid #2563eb}
@media(max-width:800px){
.navgrid{grid-template-columns:repeat(6,1fr)}
}
</style>
</head>

<body>
<header><h2>PTCB Ultimate Practice Exam</h2></header>

<div class="wrap">

<div id="start" class="card">
<h3>Start Exam</h3>
<label><input type="checkbox" id="timerToggle"> Timed (90 min)</label><br>
<label><input type="checkbox" id="learningToggle" checked> Learning Mode</label><br>
<label><input type="checkbox" id="rxnavToggle" checked> Dynamic Med Questions</label><br><br>
<button onclick="startExam()">Start Exam</button>
</div>

<div id="exam" class="card" style="display:none">
<div id="progress"></div>
<h3 id="question"></h3>
<div id="choices"></div>

<button onclick="prevQ()">Prev</button>
<button onclick="nextQ()">Next</button>
<button onclick="flagQ()">Flag</button>

<div class="navgrid" id="nav"></div>
</div>

<div id="results" class="card" style="display:none">
<h3 id="score"></h3>
<button onclick="location.reload()">Restart</button>
</div>

</div>

<script>

/* ========= DOMAIN COUNTS ========= */
const DOMAIN_COUNTS={med:36,safe:24,order:19,law:11};

/* ========= LEARNING STORAGE ========= */
const STAT_KEY="ptcb_stats_v5";
function getStats(){return JSON.parse(localStorage.getItem(STAT_KEY)||"{}")}
function saveStats(s){localStorage.setItem(STAT_KEY,JSON.stringify(s))}

/* ========= QUESTION BANK ========= */
const BANK={

med:[
["Brand for atorvastatin?","Lipitor",["Zoloft","Lasix","Protonix"]],
["Warfarin highest bleed interaction?","NSAIDs",["Calcium","Vitamin C","Melatonin"]],
["Rapid insulin?","Lispro",["Glargine","Detemir","NPH"]],
["Suffix ACE inhibitor?","-pril",["-sartan","-statin","-olol"]]
],

safe:[
["Correct sterile garbing order?","Hand hygiene → gown → mask → gloves",
["Gloves → gown → mask → wash hands",
"Mask → gloves → gown → wash hands",
"Gown → gloves → wash hands → mask"]],

["USP 795 covers?","Non sterile compounding",["Sterile compounding","Hazardous drugs","Controlled law"]],
["USP 797 covers?","Sterile compounding",["Non sterile","Hazardous only","Insurance"]],
["USP 800 focuses on?","Hazardous drug handling",["Sterile only","Insurance","DEA law"]],

["High osmolarity TPN usually requires?","Central line",
["Peripheral line","IM injection","Oral"]]
],

order:[

["1 gram = ? mg","1000",["100","10","10000"]],
["1 mg = ? mcg","1000",["100","10","10000"]],
["1 L = ? mL","1000",["100","10","10000"]],

["Patient 154 lb. kg?","70",["60","80","90"]],

["Patient 70kg needs 5mg/kg. Dose?","350 mg",["70 mg","140 mg","700 mg"]],

["Stock 250mg/5mL. Need 350mg. Volume?","7 mL",["5","10","3"]],

["Alligation need 5% from 10% + 2%. Ratio 10% : 2% ?","3:5",["5:3","1:1","2:3"]],

["IV 1000mL over 8hr = ? mL/hr","125",["100","150","75"]],

["Drop factor 20 gtt/mL. 125mL/hr = ? gtt/min","42",["20","60","80"]],

["Insurance rejection: refill too soon. First step?","Check last fill date and day supply",
["Override immediately","Change drug","Tell patient pay cash"]]
],

law:[
["DEA form for CII ordering?","222",["106","41","224"]],
["DEA form theft/loss?","106",["222","41","224"]],
["DEA form destruction?","41",["222","106","224"]],
["DEA pharmacy registration?","224",["222","41","106"]],
["Federal record retention minimum?","2 years",["1 year","5 years","10 years"]],
["CIII-V refill limit?","5 refills / 6 months",["Unlimited","None","2 refills"]],
["CII refills?","None",["5 refills","Unlimited","2 refills"]]
]

};

/* ========= RXNAV SIMPLE DYNAMIC ========= */
async function getDynamicMed(){
try{
let res=await fetch("https://rxnav.nlm.nih.gov/REST/drugs.json?name=metformin");
let data=await res.json();
if(data.drugGroup){
return ["Metformin brand example?","Glucophage",["Lipitor","Zoloft","Lasix"]];
}
}catch(e){}
return null;
}

/* ========= EXAM STATE ========= */
let exam=[];
let answers={};
let flagged=new Set();
let index=0;
let correct=0;

/* ========= BUILD ========= */
function pick(arr,n){
let o=[];
for(let i=0;i<n;i++){
o.push(arr[Math.floor(Math.random()*arr.length)]);
}
return o;
}

async function buildExam(){
exam=[
...pick(BANK.med,DOMAIN_COUNTS.med),
...pick(BANK.safe,DOMAIN_COUNTS.safe),
...pick(BANK.order,DOMAIN_COUNTS.order),
...pick(BANK.law,DOMAIN_COUNTS.law)
];

if(document.getElementById("rxnavToggle").checked){
let dyn=await getDynamicMed();
if(dyn) exam[Math.floor(Math.random()*exam.length)]=dyn;
}

exam=exam.slice(0,90);
}

/* ========= FLOW ========= */

async function startExam(){
await buildExam();
document.getElementById("start").style.display="none";
document.getElementById("exam").style.display="block";
renderNav();
show();
}

function show(){
let q=exam[index];
document.getElementById("progress").innerText=`Question ${index+1}/90`;
document.getElementById("question").innerHTML=q[0];

let choices=[q[1],...q[2]].sort(()=>Math.random()-0.5);

document.getElementById("choices").innerHTML=
choices.map(c=>`<div class='choice' onclick="answer('${c}')">${c}</div>`).join("");

renderNav();
}

function answer(c){
answers[index]=c;
if(c===exam[index][1]) correct++;
renderNav();
}

function nextQ(){
if(index<89){index++;show()}else finish()
}

function prevQ(){
if(index>0){index--;show()}
}

function flagQ(){
if(flagged.has(index)) flagged.delete(index);
else flagged.add(index);
renderNav();
}

function renderNav(){
let html="";
for(let i=0;i<exam.length;i++){
let cls="navbtn";
if(answers[i]) cls+=" answered";
if(flagged.has(i)) cls+=" flagged";
if(i===index) cls+=" current";
html+=`<button class='${cls}' onclick="index=${i};show()">${i+1}</button>`;
}
document.getElementById("nav").innerHTML=html;
}

function finish(){
document.getElementById("exam").style.display="none";
document.getElementById("results").style.display="block";
document.getElementById("score").innerText=
`Score: ${correct}/90 (${Math.round(correct/90*100)}%)`;
}

</script>
</body>
</html><!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>PTCB Ultimate Practice Exam</title>

<style>
body{font-family:system-ui;margin:0;background:#f4f6fb}
header{background:#111827;color:#fff;padding:16px}
.wrap{max-width:1100px;margin:auto;padding:16px}
.card{background:#fff;padding:16px;border-radius:14px;box-shadow:0 6px 20px rgba(0,0,0,.08);margin-bottom:16px}
button{background:#111827;color:white;border:none;padding:10px 14px;border-radius:10px;cursor:pointer;font-weight:600}
.choice{border:1px solid #e5e7eb;padding:12px;border-radius:10px;margin-bottom:8px;cursor:pointer}
.choice:hover{background:#eef2ff}
.navgrid{display:grid;grid-template-columns:repeat(10,1fr);gap:6px;margin-top:12px}
.navbtn{padding:8px;border-radius:8px;border:1px solid #ddd;background:white;font-size:12px;cursor:pointer}
.navbtn.answered{background:#dcfce7}
.navbtn.flagged{background:#ffedd5}
.navbtn.current{outline:2px solid #2563eb}
@media(max-width:800px){
.navgrid{grid-template-columns:repeat(6,1fr)}
}
</style>
</head>

<body>
<header><h2>PTCB Ultimate Practice Exam</h2></header>

<div class="wrap">

<div id="start" class="card">
<h3>Start Exam</h3>
<label><input type="checkbox" id="timerToggle"> Timed (90 min)</label><br>
<label><input type="checkbox" id="learningToggle" checked> Learning Mode</label><br>
<label><input type="checkbox" id="rxnavToggle" checked> Dynamic Med Questions</label><br><br>
<button onclick="startExam()">Start Exam</button>
</div>

<div id="exam" class="card" style="display:none">
<div id="progress"></div>
<h3 id="question"></h3>
<div id="choices"></div>

<button onclick="prevQ()">Prev</button>
<button onclick="nextQ()">Next</button>
<button onclick="flagQ()">Flag</button>

<div class="navgrid" id="nav"></div>
</div>

<div id="results" class="card" style="display:none">
<h3 id="score"></h3>
<button onclick="location.reload()">Restart</button>
</div>

</div>

<script>

/* ========= DOMAIN COUNTS ========= */
const DOMAIN_COUNTS={med:36,safe:24,order:19,law:11};

/* ========= LEARNING STORAGE ========= */
const STAT_KEY="ptcb_stats_v5";
function getStats(){return JSON.parse(localStorage.getItem(STAT_KEY)||"{}")}
function saveStats(s){localStorage.setItem(STAT_KEY,JSON.stringify(s))}

/* ========= QUESTION BANK ========= */
const BANK={

med:[
["Brand for atorvastatin?","Lipitor",["Zoloft","Lasix","Protonix"]],
["Warfarin highest bleed interaction?","NSAIDs",["Calcium","Vitamin C","Melatonin"]],
["Rapid insulin?","Lispro",["Glargine","Detemir","NPH"]],
["Suffix ACE inhibitor?","-pril",["-sartan","-statin","-olol"]]
],

safe:[
["Correct sterile garbing order?","Hand hygiene → gown → mask → gloves",
["Gloves → gown → mask → wash hands",
"Mask → gloves → gown → wash hands",
"Gown → gloves → wash hands → mask"]],

["USP 795 covers?","Non sterile compounding",["Sterile compounding","Hazardous drugs","Controlled law"]],
["USP 797 covers?","Sterile compounding",["Non sterile","Hazardous only","Insurance"]],
["USP 800 focuses on?","Hazardous drug handling",["Sterile only","Insurance","DEA law"]],

["High osmolarity TPN usually requires?","Central line",
["Peripheral line","IM injection","Oral"]]
],

order:[

["1 gram = ? mg","1000",["100","10","10000"]],
["1 mg = ? mcg","1000",["100","10","10000"]],
["1 L = ? mL","1000",["100","10","10000"]],

["Patient 154 lb. kg?","70",["60","80","90"]],

["Patient 70kg needs 5mg/kg. Dose?","350 mg",["70 mg","140 mg","700 mg"]],

["Stock 250mg/5mL. Need 350mg. Volume?","7 mL",["5","10","3"]],

["Alligation need 5% from 10% + 2%. Ratio 10% : 2% ?","3:5",["5:3","1:1","2:3"]],

["IV 1000mL over 8hr = ? mL/hr","125",["100","150","75"]],

["Drop factor 20 gtt/mL. 125mL/hr = ? gtt/min","42",["20","60","80"]],

["Insurance rejection: refill too soon. First step?","Check last fill date and day supply",
["Override immediately","Change drug","Tell patient pay cash"]]
],

law:[
["DEA form for CII ordering?","222",["106","41","224"]],
["DEA form theft/loss?","106",["222","41","224"]],
["DEA form destruction?","41",["222","106","224"]],
["DEA pharmacy registration?","224",["222","41","106"]],
["Federal record retention minimum?","2 years",["1 year","5 years","10 years"]],
["CIII-V refill limit?","5 refills / 6 months",["Unlimited","None","2 refills"]],
["CII refills?","None",["5 refills","Unlimited","2 refills"]]
]

};

/* ========= RXNAV SIMPLE DYNAMIC ========= */
async function getDynamicMed(){
try{
let res=await fetch("https://rxnav.nlm.nih.gov/REST/drugs.json?name=metformin");
let data=await res.json();
if(data.drugGroup){
return ["Metformin brand example?","Glucophage",["Lipitor","Zoloft","Lasix"]];
}
}catch(e){}
return null;
}

/* ========= EXAM STATE ========= */
let exam=[];
let answers={};
let flagged=new Set();
let index=0;
let correct=0;

/* ========= BUILD ========= */
function pick(arr,n){
let o=[];
for(let i=0;i<n;i++){
o.push(arr[Math.floor(Math.random()*arr.length)]);
}
return o;
}

async function buildExam(){
exam=[
...pick(BANK.med,DOMAIN_COUNTS.med),
...pick(BANK.safe,DOMAIN_COUNTS.safe),
...pick(BANK.order,DOMAIN_COUNTS.order),
...pick(BANK.law,DOMAIN_COUNTS.law)
];

if(document.getElementById("rxnavToggle").checked){
let dyn=await getDynamicMed();
if(dyn) exam[Math.floor(Math.random()*exam.length)]=dyn;
}

exam=exam.slice(0,90);
}

/* ========= FLOW ========= */

async function startExam(){
await buildExam();
document.getElementById("start").style.display="none";
document.getElementById("exam").style.display="block";
renderNav();
show();
}

function show(){
let q=exam[index];
document.getElementById("progress").innerText=`Question ${index+1}/90`;
document.getElementById("question").innerHTML=q[0];

let choices=[q[1],...q[2]].sort(()=>Math.random()-0.5);

document.getElementById("choices").innerHTML=
choices.map(c=>`<div class='choice' onclick="answer('${c}')">${c}</div>`).join("");

renderNav();
}

function answer(c){
answers[index]=c;
if(c===exam[index][1]) correct++;
renderNav();
}

function nextQ(){
if(index<89){index++;show()}else finish()
}

function prevQ(){
if(index>0){index--;show()}
}

function flagQ(){
if(flagged.has(index)) flagged.delete(index);
else flagged.add(index);
renderNav();
}

function renderNav(){
let html="";
for(let i=0;i<exam.length;i++){
let cls="navbtn";
if(answers[i]) cls+=" answered";
if(flagged.has(i)) cls+=" flagged";
if(i===index) cls+=" current";
html+=`<button class='${cls}' onclick="index=${i};show()">${i+1}</button>`;
}
document.getElementById("nav").innerHTML=html;
}

function finish(){
document.getElementById("exam").style.display="none";
document.getElementById("results").style.display="block";
document.getElementById("score").innerText=
`Score: ${correct}/90 (${Math.round(correct/90*100)}%)`;
}

</script>
</body>
</html>
